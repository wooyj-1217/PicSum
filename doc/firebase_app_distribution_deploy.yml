name: Firebase App Distributionì— Debug App ë°°í¬
on:
  push:
    branches:
      - 'develop/*'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: âœ… ì½”ë“œ ì²´í¬ì•„ì›ƒ í•´ì˜¤ê¸°
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: â˜• JDK 17 ì„¤ì •
        uses: actions/setup-java@v1
        with:
          java-version: '17'
          cache: gradle

        # [Document] https://github.com/webfactory/ssh-agent
      - name: ğŸ” SSH Key ì„¤ì •
        uses: webfactory/ssh-agent@v0.5.3
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: âœï¸ Release Note ì‘ì„±í•˜ê¸°
        id: get_commit_messages
        run: |
          LAST_TAG=$(git describe --tags --abbrev=0 2>/dev/null || echo "")
          if [ -z "$LAST_TAG" ]; then
            git log --pretty=format:"%s" --no-merges > commit_messages.txt
          else
            git log $LAST_TAG..HEAD --pretty=format:"%s" --no-merges > commit_messages.txt
          fi
        shell: bash

      - name: ğŸ–¨ï¸ Release Note ì¶œë ¥
        run: cat commit_messages.txt

      - name: ğŸ—ï¸ Debug Apk Gradle ë¹Œë“œ
        run: ./gradlew clean assembleDevDebug -x ktlintCheck
        env:
          GRADLE_OPTS: "-Dorg.gradle.daemon=false"

      # [Document] https://github.com/wzieba/Firebase-Distribution-Github-Action
      - name: ğŸš€ Firebaseì— ë°°í¬
        uses: wzieba/Firebase-Distribution-Github-Action@v1.7.0
        with:
          appId: ${{ secrets.FIREBASE_APP_ID_DEBUG }}
          groups: ${{ secrets.FIREBASE_TESTER_GROUPS}}
          serviceCredentialsFileContent: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_KEY }}
          file: app/build/outputs/apk/dev/debug/app-dev-debug.apk
          releaseNotesFile: commit_messages.txt